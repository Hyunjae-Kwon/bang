<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="recommend">

<!-- 관광지 추천 게시판 [RC] -->

	<!-- [selectRecomDesc] 메인 페이지 - 추천 여행지 3개 (기준 미정으로 임시로 조회수로 작성) -->
	<select id="selectRecomDesc" resultType="hashmap">
	 <![CDATA[
			SELECT RC_NUM, RC_TITLE, RC_REGDATE, RC_ID, RC_CNT, RC_LIKE, RC_CONTENT, RC_IMAGE, R
			FROM (SELECT RC_NUM, RC_TITLE, RC_REGDATE, RC_ID, RC_CNT, RC_LIKE, RC_CONTENT, RC_IMAGE, ROWNUM R
				FROM (SELECT RC_NUM, RC_TITLE, RC_REGDATE, RC_ID, RC_CNT, RC_LIKE, RC_CONTENT, RC_IMAGE
					FROM RECOMMEND
					ORDER BY RC_CNT DESC)
				)
			WHERE R BETWEEN 1 AND 3
	   ]]>
	</select>
	
	<!-- [recommendCount] 여행지 추천 게시글 수(전체&검색) -->
 	<select id="recommendCount" resultType="hashmap">
		SELECT COUNT(*) COUNT
		FROM RECOMMEND
		<trim prefix="WHERE" prefixOverrides="OR">
			<if test="searchKeyword != NULL">
				RC_TITLE LIKE '%'||#{searchKeyword}||'%' OR RC_CONTENT LIKE '%'||#{searchKeyword}||'%'
			</if>
		</trim>
	</select>
	
	<!-- [recommendListPaging] 여행지 추천 게시글 리스트(전체&검색) -->
	<select id="recommendListPaging" resultType="hashmap" parameterType="hashmap">
	<include refid="common.pagingPre"/>
		SELECT
			ROW_NUMBER() OVER (ORDER BY RC_NUM DESC) RNUM,
		    RC_NUM,
		    RC_TITLE,
		    RC_REGDATE,
		    RC_ID,
		    RC_CNT,
		    RC_LIKE,
		    RC_CONTENT,
		    RC_IMAGE 
		FROM
			RECOMMEND
	    <trim prefix="WHERE" prefixOverrides="OR">
			<if test="searchKeyword != NULL">
				RC_TITLE LIKE '%'||#{searchKeyword}||'%' OR RC_CONTENT LIKE '%'||#{searchKeyword}||'%'
			</if>
		</trim>
	<include refid="common.pagingPost"/>
	</select>
	
	<!-- [searchRecommend] 여행지 추천 검색(메인에서 검색) -->
	<select id="searchRecommend" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT * FROM RECOMMEND
			WHERE RC_TITLE LIKE '%'||#{searchKeyword}||'%' OR RC_CONTENT LIKE '%'||#{searchKeyword}||'%'
		]]>
   </select>
	
	<!-- [recommendDetail] 여행지 추천 게시글 상세보기 -->
	<select id="recommendDetail" parameterType="hashmap" resultType="hashmap">
     <![CDATA[
     		SELECT * 
				FROM RECOMMEND
				WHERE RC_NUM = #{RC_NUM}
     ]]>
	</select>
	
	<!-- [updateCnt] 조회수 증가 -->
	<update id="updateCnt" parameterType="hashmap">
    <![CDATA[
		UPDATE RECOMMEND 
		      SET
		         RC_CNT = NVL(RC_CNT, 0) + 1
		      WHERE
		         RC_NUM = #{RC_NUM}   
    ]]>
	</update>
	
	<!-- 여행지추천글 쓰기 -->
	<insert id="insertRecommend" parameterType="hashmap"> 
	<![CDATA[
			INSERT
			INTO RECOMMEND
			VALUES(
				RC_NUM_SEQ.NEXTVAL,
				#{RC_TITLE},   
				SYSDATE,
				#{RC_ID},
				0,
				0,
				#{RC_CONTENT},
				#{RC_IMAGE}
				)
		]]>
	</insert>
	
	<!-- [deleteRecommend] 여행지 추천 게시글 삭제하기 -->
	<delete id="deleteRecommend" parameterType="hashmap">
	<![CDATA[
		DELETE 
			FROM RECOMMEND
			WHERE RC_NUM=#{RC_NUM}
	]]>
	</delete>
	
	<!-- [recommendModifyForm] 여행지 추천 게시글 수정 폼 -->
	<select id="recommendModifyForm" parameterType="hashmap" resultType="hashmap">
      <![CDATA[
         SELECT
            RC_NUM,
            RC_TITLE,
            RC_CONTENT,
            RC_REGDATE
         FROM
            RECOMMEND
         WHERE
            RC_NUM = #{RC_NUM}
      ]]>
	</select>

	<!-- [recommendModify] 여행지 추천 게시글 수정하기 -->
	<update id="recommendModify" parameterType="hashmap">
      <![CDATA[
         UPDATE
            RECOMMEND
         SET
            RC_TITLE = #{RC_TITLE},
            RC_CONTENT = #{RC_CONTENT}
         WHERE
            RC_NUM = #{RC_NUM}                 
      ]]>
	</update>
	
	<!-- [recommendLike] 추천하기 -->
	<update id="recommendLike" parameterType="hashmap">
	<![CDATA[
		UPDATE 
			RECOMMEND 
		SET RC_LIKE = RC_LIKE + 1 WHERE RC_NUM = #{RC_NUM}
	]]>
	</update>
	
	<!-- 댓글목록 -->
	<select id="rcCommentList" parameterType="hashmap" resultType="hashmap">
      <![CDATA[
         SELECT 
          	BC_BCID, 
          	BC_NUM, 
          	BC_COMMENT, 
          	BC_REGDATE, 
          	BC_ID      
         FROM BOARDCOMMENT 
         WHERE BC_NUM = #{RC_NUM} AND BC_TYPE='RC'
         ORDER BY BC_BCID DESC 
      ]]>
	</select>
	
	<!--  여행지 댓글 작성 -->
	<insert id="rcCommentWrite" parameterType="hashmap">
		INSERT 
		INTO BOARDCOMMENT
		VALUES (	
			BC_BCID_SEQ.NEXTVAL,
			#{RC_NUM},
			#{MEM_ID},
			SYSDATE,
			#{BC_COMMENT},
			'RC'
		)
	</insert>
	
	<!-- 댓글삭제 -->
	<delete id="rcCommentDelete" parameterType="hashmap">
   	<![CDATA[
     	DELETE 
			FROM BOARDCOMMENT
			WHERE BC_BCID=#{BC_BCID}
   	]]>
	</delete>

</mapper>