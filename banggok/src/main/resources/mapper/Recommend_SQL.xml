<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="recommend">

<!-- 관광지 추천 게시판 [RC] -->

	<!-- [selectRecomDesc] 메인 페이지 - 추천 여행지 3개 (기준 미정으로 임시로 조회수로 작성) -->
	<select id="selectRecomDesc" resultType="hashmap">
	 <![CDATA[
			SELECT RC_NUM, RC_TITLE, RC_REGDATE, RC_ID, RC_CNT, RC_LIKE, RC_CONTENT, RC_IMAGE, R
			FROM (SELECT RC_NUM, RC_TITLE, RC_REGDATE, RC_ID, RC_CNT, RC_LIKE, RC_CONTENT, RC_IMAGE, ROWNUM R
				FROM (SELECT RC_NUM, RC_TITLE, RC_REGDATE, RC_ID, RC_CNT, RC_LIKE, RC_CONTENT, RC_IMAGE
					FROM RECOMMEND
					ORDER BY RC_CNT DESC)
				)
			WHERE R BETWEEN 1 AND 3
	   ]]>
	</select>
	
	<!-- [recommendList] 여행지 추천 게시글 리스트 -->
	<select id="recommendList" resultType="hashmap" parameterType="hashmap">
	 <![CDATA[
			SELECT * FROM RECOMMEND
	   ]]>
	</select>
	
	<!-- [recommendDetail] 여행지 추천 게시글 상세보기 -->
	<select id="recommendDetail" parameterType="hashmap" resultType="hashmap">
     <![CDATA[
     		SELECT * 
				FROM RECOMMEND
				WHERE RC_NUM = #{RC_NUM}
     ]]>
	</select>
	
	<!-- [updateCnt] 조회수 증가 -->
	<update id="updateCnt" parameterType="hashmap">
    <![CDATA[
		UPDATE RECOMMEND 
		      SET
		         RC_CNT = NVL(RC_CNT, 0) + 1
		      WHERE
		         RC_NUM = #{RC_NUM}   
    ]]>
	</update>
	
	<!-- [insertRecommend] 여행지 추천 게시글 작성하기 -->
	<!-- jdbcType=VARCHAR 넣어봤는데 잘 모르겠음 오류는 다르게 뜨긴 --> 
	<insert id="insertRecommend" parameterType="hashmap">  <!--
	<![CDATA[
			INSERT
			INTO RECOMMEND
			VALUES(
				RC_NUM_SEQ.NEXTVAL,
				#{RC_TITLE, jdbcType=VARCHAR},   
				SYSDATE,
				#{RC_ID, jdbcType=VARCHAR},
				0,
				0,
				#{RC_CONTENT, jdbcType=VARCHAR},
				#{RC_IMAGE, jdbcType=VARCHAR}
				)
		]]>
	</insert> -->
	<![CDATA[
			INSERT
			INTO RECOMMEND
			VALUES(
				RC_NUM_SEQ.NEXTVAL,
				#{RC_TITLE},   
				SYSDATE,
				#{RC_ID},
				0,
				0,
				#{RC_CONTENT},
				#{RC_IMAGE}
				)
		]]>
	</insert>
	
	<!-- [deleteRecommend] 여행지 추천 게시글 삭제하기 -->
	<delete id="deleteRecommend" parameterType="hashmap">
	<![CDATA[
		DELETE 
			FROM RECOMMEND
			WHERE RC_NUM=#{RC_NUM}
	]]>
	</delete>
	
	<!-- [recommendModifyForm] 여행지 추천 게시글 수정 폼 -->
	<select id="recommendModifyForm" parameterType="hashmap" resultType="hashmap">
      <![CDATA[
         SELECT
            RC_NUM,
            RC_TITLE,
            RC_CONTENT,
            RC_REGDATE
         FROM
            RECOMMEND
         WHERE
            RC_NUM = #{RC_NUM}
      ]]>
	</select>

	<!-- [recommendModify] 여행지 추천 게시글 수정하기 -->
	<update id="recommendModify" parameterType="hashmap">
      <![CDATA[
         UPDATE
            RECOMMEND
         SET
            RC_TITLE = #{RC_TITLE},
            RC_CONTENT = #{RC_CONTENT}
         WHERE
            RC_NUM = #{RC_NUM}                 
      ]]>
	</update>
	
	<!-- [recommendLike] 추천하기 -->
	<update id="recommendLike" parameterType="hashmap">
	<![CDATA[
		UPDATE 
			RECOMMEND 
		SET RC_LIKE = RC_LIKE + 1 WHERE RC_NUM = #{RC_NUM}
	]]>
	</update>
	
	<!-- [searchRecommend] 여행지 추천 검색 -->
	<select id="searchRecommend" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT * FROM RECOMMEND
			WHERE RC_TITLE LIKE '%'||#{keyword}||'%' OR RC_CONTENT LIKE '%'||#{keyword}||'%'
		]]>
	</select>

</mapper>